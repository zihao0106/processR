# processR 面板数据扩展方案

## 概述
以最小代价为 processR 包添加面板数据分析功能，通过集成现有包（plm, panelvar 等）实现面板数据的调节中介分析。

## 核心设计理念
1. **保持向后兼容**：原有功能完全保留
2. **最小侵入性**：通过参数控制面板数据分析
3. **模块化设计**：面板数据功能作为独立模块
4. **利用现有包**：集成 plm, panelvar, sandwich 等成熟包

## 主要扩展内容

### 1. 新增依赖包
- `plm`: 面板数据线性模型
- `panelvar`: 面板向量自回归
- `sandwich`: 稳健标准误
- `lmtest`: 面板数据诊断

### 2. 新增核心函数

#### 2.1 面板数据预处理函数
```r
prepare_panel_data(data, id, time, balance = TRUE)
```

#### 2.2 面板调节中介分析函数
```r
panel_multipleMediation(...)  # 面板多重中介
panel_modmedSummary(...)      # 面板调节中介汇总
panel_conditionalEffect(...)  # 面板条件效应
```

#### 2.3 面板数据可视化函数
```r
panel_drawModel(...)          # 面板模型路径图
panel_condPlot(...)           # 面板条件效应图
```

### 3. 现有函数扩展
为主要函数添加面板数据支持：
- `multipleMediation()` 添加 `panel = FALSE` 参数
- `modmedSummary()` 添加面板数据处理逻辑
- `drawModel()` 支持面板数据结果可视化

## 技术实现策略

### 1. 数据结构适配
```r
# 检测是否为面板数据
is_panel_data <- function(data, id = NULL, time = NULL) {
  if (is.null(id) || is.null(time)) return(FALSE)
  return(all(c(id, time) %in% colnames(data)))
}
```

### 2. 模型估计策略
- **固定效应模型**：控制个体异质性
- **随机效应模型**：考虑个体随机变异
- **系统GMM**：处理内生性问题
- **稳健标准误**：修正面板数据异方差和序列相关

### 3. 路径分析适配
- 将横截面路径模型扩展到面板维度
- 考虑时间效应和个体效应
- 支持滞后变量和动态面板模型

## 实施步骤

### 阶段一：基础架构（2-3周）
1. 添加面板数据检测和预处理功能
2. 修改现有函数以支持面板数据参数
3. 集成 plm 包进行基础面板回归

### 阶段二：核心功能（3-4周）
1. 实现面板调节中介分析
2. 添加面板数据的路径分析支持
3. 实现面板数据的间接效应计算

### 阶段三：高级功能（2-3周）
1. 添加动态面板模型支持
2. 实现面板数据可视化功能
3. 完善文档和示例

### 阶段四：测试和优化（1-2周）
1. 全面测试和调试
2. 性能优化
3. 用户文档完善

## 优势和创新点

1. **填补空白**：目前很少有R包专门处理面板数据的调节中介分析
2. **方法先进**：结合面板数据技术和中介分析最新发展
3. **易于使用**：保持 processR 的用户友好界面
4. **统计严谨**：正确处理面板数据的统计问题

## 示例应用场景

1. **纵向研究**：追踪个体或组织随时间的变化
2. **政策评估**：分析政策干预的中介机制
3. **组织研究**：研究企业管理实践的作用机制
4. **发展心理学**：分析个体发展过程中的中介变量

这个扩展方案可以显著提升 processR 的应用价值，使其成为面板数据调节中介分析的首选工具。
